@page "{id}"
@model Scores.UI.Pages.ClubModel
@{
}

<div class="club-container">
    <img src="/FC_Barcelona.svg" alt="club image" />
    <div class="club-info">
        <h5>@Model.Club.Name</h5>
        <div class="club-info-table">
            <div class="club-info-e">Country</div>
            <div class="club-info-i">@Model.Club.Venue.City.Country</div>
            <div class="club-info-e">City</div>
            <div class="club-info-i">@Model.Club.Venue.City.Name</div>
            <div class="club-info-e">Founded</div>
            <div class="club-info-i">@Model.Club.YearFounded</div>
            <div class="club-info-e">Venue</div>
            <div class="club-info-i">@Model.Club.Venue.Name</div>
        </div>
    </div>
</div>

<div class="club-section-container">
    <h5>Matches</h5>

    @foreach (var match in Model.Matches)
    {
        var result = match.MatchInfo.FirstOrDefault(x => x.Class == "FT");
        var playingHome = match.HomeTeam.Id == Model.Club.Id ? true : false;

        <div class="match-container">
            <a class="match-home-team" asp-page="/Club" asp-route-id="@match.HomeTeam.Id">
                @match.HomeTeam.Name
            </a>

            @if (result is null)
            {
                <a class="match-result" asp-page="/Match" asp-route-id="@match.Id">
                    @match.KickOff.ToString("HH:mm")
                </a>
            }
            else
            {
                string resultColor;

                if (playingHome)
                {
                    resultColor = result.HomeScore > result.AwayScore ? "var(--clr-win)" : "";
                    resultColor = result.HomeScore < result.AwayScore ? "var(--clr-loss)" : resultColor;
                    resultColor = result.HomeScore == result.AwayScore ? "var(--clr-draw)" : resultColor;
                }
                else
                {
                    resultColor = result.HomeScore > result.AwayScore ? "var(--clr-loss)" : "";
                    resultColor = result.HomeScore < result.AwayScore ? "var(--clr-win)" : resultColor;
                    resultColor = result.HomeScore == result.AwayScore ? "var(--clr-draw)" : resultColor;
                }

                <a class="match-result" style="background: @resultColor"
                   asp-page="/Match" asp-route-id="@match.Id">
                    @(result.HomeScore):@(result.AwayScore)
                </a>
            }

            <a class="match-away-team" asp-page="/Club" asp-route-id="@match.AwayTeam.Id">
                @match.AwayTeam.Name
            </a>
        </div>
    }

    <h5>Squad</h5>


    <div class="squad-container">
        @foreach (var player in Model.Squad.Where(x => x.Position == "Goalkeeper"))
        {
            <a asp-page="/Player" asp-route-id="@player.Id">
                <div class="squad-player">
                    <div class="squad-player-number" style="background: var(--clr-@player.Position.ToLower())">
                        <span>
                            @player.ShirtNumber
                        </span>
                    </div>
                    <div class="squad-name-dob">
                        <div class="squad-player-name">
                            @player.FirstName @player.LastName
                        </div>
                        <div class="squad-player-dob">
                            @{
                                var today = DateTime.Now;
                                var dob = player.DoB;

                                int age = dob.Month > today.Month || dob.Month == today.Month && dob.Day > today.Day
                                    ? today.Year - dob.Year - 1 : today.Year - dob.Year;
                            }

                            @age years old
                        </div>
                    </div>
                </div>
            </a>
        }
    </div>
    <div class="squad-container">
        @foreach (var player in Model.Squad.Where(x => x.Position == "Defender"))
        {
            <a asp-page="/Player" asp-route-id="@player.Id">
                <div class="squad-player">
                    <div class="squad-player-number" style="background: var(--clr-@player.Position.ToLower())">
                        <span>
                            @player.ShirtNumber
                        </span>
                    </div>
                    <div class="squad-name-dob">
                        <div class="squad-player-name">
                            @player.FirstName @player.LastName
                        </div>
                        <div class="squad-player-dob">
                            @{
                                var today = DateTime.Now;
                                var dob = player.DoB;

                                int age = dob.Month > today.Month || dob.Month == today.Month && dob.Day > today.Day
                                    ? today.Year - dob.Year - 1 : today.Year - dob.Year;
                            }

                            @age years old
                        </div>
                    </div>
                </div>
            </a>
        }
    </div>
    <div class="squad-container">
        @foreach (var player in Model.Squad.Where(x => x.Position == "Midfielder"))
        {
            <a asp-page="/Player" asp-route-id="@player.Id">
                <div class="squad-player">
                    <div class="squad-player-number" style="background: var(--clr-@player.Position.ToLower())">
                        <span>
                            @player.ShirtNumber
                        </span>
                    </div>
                    <div class="squad-name-dob">
                        <div class="squad-player-name">
                            @player.FirstName @player.LastName
                        </div>
                        <div class="squad-player-dob">
                            @{
                                var today = DateTime.Now;
                                var dob = player.DoB;

                                int age = dob.Month > today.Month || dob.Month == today.Month && dob.Day > today.Day
                                    ? today.Year - dob.Year - 1 : today.Year - dob.Year;
                            }

                            @age years old
                        </div>
                    </div>
                </div>
            </a>
        }
    </div>
    <div class="squad-container">
        @foreach (var player in Model.Squad.Where(x => x.Position == "Attacker"))
        {
            <a asp-page="/Player" asp-route-id="@player.Id">
                <div class="squad-player">
                    <div class="squad-player-number" style="background: var(--clr-@player.Position.ToLower())">
                        <span>
                            @player.ShirtNumber
                        </span>
                    </div>
                    <div class="squad-name-dob">
                        <div class="squad-player-name">
                            @player.FirstName @player.LastName
                        </div>
                        <div class="squad-player-dob">
                            @{
                                var today = DateTime.Now;
                                var dob = player.DoB;

                                int age = dob.Month > today.Month || dob.Month == today.Month && dob.Day > today.Day
                                    ? today.Year - dob.Year - 1 : today.Year - dob.Year;
                            }

                            @age years old
                        </div>
                    </div>
                </div>
            </a>
        }
    </div>
</div>
